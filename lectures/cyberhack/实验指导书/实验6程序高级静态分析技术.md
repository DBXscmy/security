# 实验 6 程序高级静态分析技术

## 实验目的

掌握程序静态分析技术，能够使用反汇编工具分析恶意代码。

## 实验前提

请安装虚拟机 winXPenSP3 调试环境。

本节课所用到的文件均存放在windXPenSP3 调试环境虚拟机 C:\workspace\PracticalMalwareAnalysis-Labs\Practical Malware Analysis Labs\BinaryCollection 目录的Chapter_1L中。

注意：请在分析样本前，在C:\workspace\ 下建立一个tmp临时文件夹，存放要分析的文件。因为某些分析过程可能会破坏原文件。

## 实验内容

### 五.使用IDA Pro分析在文件Lab05-Ol .d11中发现的恶意代码。

1. D11Main的地址是什么?
2.使用Imports窗口并二浏览到gethostbyname,导入函数定位到什么地址?
3.有多少函数调川了gethostbyname?
4.将精力集「}，在位于0x10001757处的对gethostbyname的调用，你能找出叨1;个DNS请求将被触
    发吗?
5.   IDA Pro识别了在0x10001656处的子过程中的多少个局部变量?
6.   IDA Pro识别了在0x10001656处的子过程中的多少个参数?
7.使用Strings窗I=1，来在反汇编中定位字符串\cmd.exe /c。它位于哪?
8.在引用\cmd.exe /c的代码所在的区域发生了什么?
9.在同样的区域，在。x100101C8处，看起来好像dword_ 1008E5C4是一个全局变量，它帮助决定
    赤哪条路径。那恶意代码是如何设置dword 1008E5C4的呢?(提示:使用dword 1008E5C4
    的交叉弓ij习。)
1 U.在位于。x1000FF58处的J气过程}n，的儿}r行指令中，一系列使用memcmp来比较字符串的比较。
  如果对robotwork的字符11飞比较是成功的("'} memcmp返U o>，会发生什么?
11. PSL工ST导出函数做了什么?
12.使川图模式来绘制出对sub_ 10004E79的交叉引用图。当进入这个函数时，i哪个API函数可能被
    调川?仅仅墓于这些API函数，你会如何币命名这个函数?
13. D11Main直接调川了多少个Windows API?多少个在深度为_7时被调用?
14.在0x10001358处，有个对Sleep(一个使用一个包含要睡眠的毫秒数的参数的API函数)的
    调川。顺着代码向后石一，如果这段代码执行，这个程序会睡眠多久?
15.在0x10001701处足一个对socket的调fll。它的3个参数是什么?
16.使川MSDN }! X11的socket和IDA Pro中的命名符号常e，你能使参数更加有意义吗?在你应rr}
    1一修改以后，参数是什么?
17.搜索in指令(opcode OxED)的使用。这个指令和一个魔术字符串VMXh用来进行V Mware检测。
    这在这个恶意代码中被使用了吗?使川对执行in指令函数的交叉引用，能发现进一步检测
    VMware的u}一据u}3?
18.将你的光标跳转S}}J ox l oo I D9gs处，你发J见了fl一么’2
19.如果你安装了IDA Python插件(包括IDA Pro的商业版本的插件)，运行La605-Ol.py，一个本
  书中随恶意代码提供的IDA Pro Python脚本，(确定光标是在Ox 1001 D988处。)在你运行这个
    脚本后发生了什么?
20.将光标放在同一位置，你如何将这个数据转成一个单一的ASCII字符串?
21.付}ll}一个文木编辑器打开这个脚木。它是如何1二作的?