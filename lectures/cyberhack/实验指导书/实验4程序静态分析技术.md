# 实验 4 程序静态分析技术

## 实验目的

掌握程序静态分析技术，能够使用工具初步分析恶意代码。

## 实验前提

请安装虚拟机 winXPenSP3 调试环境。

本节课所用到的文件均存放在windXPenSP3 调试环境虚拟机中，C:\workspace\PracticalMalwareAnalysis-Labs\Practical Malware Analysis Labs\BinaryCollection目录的Chapter_1L中。

## 实验内容

1.使用工具和技术来获取文件Lab01-Ol.exe和Lab01-Ol .d11的信息。
2.分析Lab01-02.exe文件。
3.分析La601-03.exe文件。
4.分析Lab01-04.exe文件。

## 实验步骤

### 一.使用工具和技术来获取文件Lab01-Ol.exe和Lab01-Ol .d11的信息。

1.将文件上传至[http: //www.VirusTotal.com](https://www.virustotal.com)行分析并查看报告。

2.右键点击这些文件，查看这些文件的属性，回答它们是什么时候生成的?

3.使用C:\tools\static中strings工具或PEiD工具，检查文件并判断这两个文件是否被混淆或加了壳并说明理由。

4.使用Dependency Walker工具检查这两个文件是否有导入函数？显示出了这个恶意代码是做什么的?如果是，是哪些导入函数?


5.是否有任何其他文件或基于主机的迹象，让你可以在受感染系统上查找?
是否有基于网络的迹象，可以用来发现受感染机器上的这个恶意代码?
你猜这些文件的目的是什么?


Lab01-Ol.exe中有意思的导入函数有FindFirstFile. FindNextFile和CopyFile。这些导入
函数告诉我们，这个程序在搜索文件系统和复制文件。Lab01-OLdll最有趣的导入函数是
CreateProcess和Sleep。我们也看到，这个文件导入一’WS2_ 32.d11中的函数，这些函数提供
了联网功能。
检查C:1 Windows I Svstem321 kerne 132. dll来发现额外的恶意活动。请注意，文件kernel32.DLL用
数字I代替了字母1，是为了看起来像是系统文件kernel32.d11。这个文件可以用来在主机作为恶
意代码感染的迹象进行搜索。
.dll文件中包含一个私有子网IP地址127.26.152.13的字符串。这个LP地址预示着这个程序是为
了教学日的而不是恶意目的而编制的，如果这是真正的恶意代码，这个IP地址应该是可路由的
公网IP地址，它会是一个很好的基于网络的恶意代码感染迹象，可以用来识别这个恶意代码。


### 二.分析Lab01-02.exe文件。

1.将Lab01-02.exe文件上传至http: llwH w. VirusTotal. comb行分析并查看报告。文件匹配到了已有的反病毒软件特征吗?
2.是否有这个文件被加壳或混淆的任何迹象?如果是这样，这些迹象是什么?如果该文件被加壳，请进行脱壳，如果可能的话。
3.有没有任何导入函数能够暗示出这个程序的功能?如果是，是哪些导入函数，它们会告诉你什么?
4.哪些基于主机或基于网络的迹象可以被用来确定被这个恶意代码所感染的机器?


### 三.分析La601-03.exe文件。

1.将Lab01-03.exe文件上传至http: //www. VirusTotal.com/%}行分析并查看报告。文件匹配到了已有
    的反病毒软件特征吗?
2.是否有这个文件被加壳或混淆的任何迹象?如果是这样，这些迹象是什么?如果该文件被加壳，
    请进行脱壳，如果可能的话。
3.有没有任何导入函数能够暗示出这个程序的功能?如果是，是哪些导入函数，它们会告诉你什
    么?
4.有哪些基于主机或基于网络的迹象，可以被用来确定被这个恶意代码所感染的机器?

### 四.分析Lab01-04.exe文件。

1.将Lab01-04.exe文件上传至http: //www. VirusTotal. coml%}行分析并查看报告。文件匹配到了己有
    的反病毒软件特征吗?
2.是否有这个文件被加壳或混淆的任何迹象?如果是这样，这些迹象是什么?如果该文件被加壳，
    请进行脱壳，如果可能的话。
3.这个文件是什么时候被编译的?
4有没有任何导入函数能够暗示出这个程序的功能?如果是，是哪些导入函数，它们会告诉你什
    么?
5.有哪些基于主机或基于网络的迹象，可以被用来确定被这个恶意代码所感染的机器?
6.这个文件在资源段中包含一个资源。使用Resource Hacker工具来检查资源，然后抽取资源。从
    资源中你能发现千卜么吗?


